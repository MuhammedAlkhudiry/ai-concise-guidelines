# AGENTS.md

This file provides guidance to AI coding agents working in this repository.

## Project Overview

This repository contains opinionated AI guidelines, skills, and agents for OpenCode. The content is installed to user machines via `src/init.ts`. This is a **documentation/configuration repository** with a generator script.

## Repository Structure

```
â”œâ”€â”€ content/                 # SOURCE OF TRUTH (all text content)
â”‚   â”œâ”€â”€ base-rules.md        # Global rules for all modes
â”‚   â””â”€â”€ instructions/        # All agent/skill instructions
â”‚       â””â”€â”€ <name>.md
â”œâ”€â”€ config/                  # Configuration (DRY)
â”‚   â”œâ”€â”€ models.ts            # Model definitions
â”‚   â”œâ”€â”€ agents.ts            # Agent configurations
â”‚   â””â”€â”€ skills.ts            # Skill configurations
â”œâ”€â”€ src/                     # Scripts and shared utilities
â”‚   â”œâ”€â”€ fs.ts                # Shared filesystem utilities
â”‚   â”œâ”€â”€ print.ts             # Colored console output
â”‚   â”œâ”€â”€ generate.ts          # Generator script
â”‚   â””â”€â”€ init.ts              # Installer script
â”œâ”€â”€ plugins/                 # OpenCode plugins (source)
â”‚   â””â”€â”€ loop.ts              # Autonomous loop plugin
â”œâ”€â”€ shell/                   # Shell configuration files
â”‚   â”œâ”€â”€ zsh-custom.zsh       # Custom zsh config (synced via --zsh-path)
â”‚   â””â”€â”€ zshrc.zsh            # Reference .zshrc (manual setup)
â”œâ”€â”€ output/                  # GENERATED OUTPUT (do not edit directly)
â”‚   â””â”€â”€ opencode/
â”‚       â”œâ”€â”€ agents/          # Generated agents with frontmatter
â”‚       â”œâ”€â”€ skills/          # Generated skills with frontmatter
â”‚       â””â”€â”€ plugin/          # OpenCode plugins (copied from plugins/)
â””â”€â”€ AGENTS.md                # AI agent instructions for this repo
```

## Commands

### Generate Output Files

**ALWAYS run this after modifying content or config:**

```bash
bun src/generate.ts
```

Always cleans output directory before generating.

### Installer Script

```bash
# Install to OpenCode (hardcoded paths)
bun src/init.ts
```

---

## Code Style Guidelines

### Content Files (`content/`)

All instruction content lives here. No frontmatterâ€”frontmatter is added during generation.

- `base-rules.md` â€” Global rules applied to all modes
- `instructions/*.md` â€” Individual agent/skill instructions

### Config Files (`config/`)

TypeScript configuration files:

- `models.ts` â€” Model definitions (smart/fast)
- `agents.ts` â€” Agent configs (type: primary/sub, model, description)
- `skills.ts` â€” Skill configs (description for auto-discovery)

### Generated Files (`output/`)

**DO NOT EDIT DIRECTLY!** These are generated by `src/generate.ts`.

To modify output:
1. Edit content in `content/`
2. Edit config in `config/`
3. Run `bun src/generate.ts`

### Markdown Content Structure

- Use heading hierarchy (`#`, `##`, `###`)
- Tables for structured data
- Code blocks with language hints
- Line references: `[file:line]` or `[path:line-line]`

**Status Markers**:
| Marker | Meaning |
|--------|---------|
| `[ ]` | Pending |
| `[x]` | Done |
| `[~]` | Blocked |
| `[!]` | Needs decision |
| `âœ…` | Approved/Pass |
| `âš ï¸` | Warning |
| `ğŸ”„` | Request changes |
| `âŒ` | Rejected/Fail |
| `ğŸ”´` | Blocker |
| `ğŸŸ¡` | Should fix |
| `ğŸŸ¢` | Minor/Nitpick |

---

## Architecture

### Single Source of Truth

```
content/instructions/<name>.md  â†’  output/opencode/agents/<name>.md
                                â†’  output/opencode/skills/<name>/SKILL.md
```

Each instruction file can be used by an agent, a skill, or both (configured in `config/`).

### Audit Flow

```
PLAN â†’ EXECUTE â†’ Audit Orchestrator â†’ Done
```

- `audit-orchestrator` skill spawns specialized auditors
- Auditors review and report; orchestrator fixes issues
- Main agent **cannot self-approve**â€”audit approval required

---

## Adding New Content

### New Skill

1. Create `content/instructions/<skill-name>.md` (body only)
2. Add entry to `config/skills.ts`
3. Run `bun src/generate.ts`

### New Agent

1. Create `content/instructions/<agent-name>.md` (body only)
2. Add entry to `config/agents.ts` with type (primary/sub)
3. Run `bun src/generate.ts`

---

## Critical Rules

- **NO SHORTCUTS** â€” Stop and notify if only unsafe workarounds work
- **STAY IN SCOPE** â€” Halt if blocker is outside task scope
- **PROTECT DATA** â€” Never modify development DB destructively
- **NO SELF-APPROVAL** â€” Use auditor sub-agent for code approval
- **NO DEAD CODE** â€” No commented blocks, debug prints, leftover TODOs
- **PREFER EXTENDING** â€” Extend existing files over creating new ones
- **AFTER-TASK CHECKLIST** â€” Run type-check/lint/format/tests
- **UPDATE DOCS** â€” When changing CLI args, configs, or user-facing behavior, always update `README.md` and `shell/zsh-custom.zsh` if affected
- **NEVER EDIT OR SELECT A MODEL**, this is always up to the user
- **READ OPENCODE DOCS** â€” When working with OpenCode features (plugins, commands, skills, agents, config), always fetch and read https://opencode.ai/docs/ first to ensure correct format and API usage
---

## File Types Summary

| Extension | Purpose | Location |
|-----------|---------|----------|
| `.md` | Content, generated output | `content/`, `output/` |
| `.ts` | Scripts, utilities, config | `src/`, `config/` |
| `.json` | Local config (not installed) | `opencode.json` |
