# AGENTS.md

This file provides guidance to AI coding agents working in this repository.

## Project Overview

This repository contains opinionated AI guidelines, skills, and agents for OpenCode. The content is installed to user machines via `init.ts`. This is a **documentation/configuration repository** with a generator script.

## Repository Structure

```
â”œâ”€â”€ content/                 # SOURCE OF TRUTH (all text content)
â”‚   â”œâ”€â”€ base-rules.md        # Global rules for all modes
â”‚   â””â”€â”€ instructions/        # All agent/skill instructions
â”‚       â””â”€â”€ <name>.md
â”œâ”€â”€ config/                  # Configuration (DRY)
â”‚   â”œâ”€â”€ models.ts            # Model definitions
â”‚   â”œâ”€â”€ agents.ts            # Agent configurations
â”‚   â””â”€â”€ skills.ts            # Skill configurations
â”œâ”€â”€ output/                  # GENERATED OUTPUT (do not edit directly)
â”‚   â””â”€â”€ opencode/
â”‚       â”œâ”€â”€ agents/          # Generated agents with frontmatter
â”‚       â””â”€â”€ skills/          # Generated skills with frontmatter
â”œâ”€â”€ generate.ts              # Generator script
â”œâ”€â”€ init.ts                  # Installer script
â””â”€â”€ AGENTS.md                # AI agent instructions for this repo
```

## Commands

### Generate Output Files

**ALWAYS run this after modifying content or config:**

```bash
bun generate.ts
```

Options:
- `--clean` â€” Remove output directory before generating

### Installer Script

```bash
# Show help
bun init.ts --help

# Install to OpenCode (adds to oh-my-opencode)
bun init.ts --rules-path ~/.config/opencode/AGENTS.md \
            --skills-path ~/.config/opencode/skill \
            --agents-path ~/.config/opencode/agent \
            --rules-file-action overwrite
```

---

## Code Style Guidelines

### Content Files (`content/`)

All instruction content lives here. No frontmatterâ€”frontmatter is added during generation.

- `base-rules.md` â€” Global rules applied to all modes
- `instructions/*.md` â€” Individual agent/skill instructions

### Config Files (`config/`)

TypeScript configuration files:

- `models.ts` â€” Model definitions (smart/fast)
- `agents.ts` â€” Agent configs (type: primary/sub, model, description)
- `skills.ts` â€” Skill configs (description for auto-discovery)

### Generated Files (`output/`)

**DO NOT EDIT DIRECTLY!** These are generated by `generate.ts`.

To modify output:
1. Edit content in `content/`
2. Edit config in `config/`
3. Run `bun generate.ts`

### Markdown Content Structure

- Use heading hierarchy (`#`, `##`, `###`)
- Tables for structured data
- Code blocks with language hints
- Line references: `[file:line]` or `[path:line-line]`

**Status Markers**:
| Marker | Meaning |
|--------|---------|
| `[ ]` | Pending |
| `[x]` | Done |
| `[~]` | Blocked |
| `[!]` | Needs decision |
| `âœ…` | Approved/Pass |
| `âš ï¸` | Warning |
| `ğŸ”„` | Request changes |
| `âŒ` | Rejected/Fail |
| `ğŸ”´` | Blocker |
| `ğŸŸ¡` | Should fix |
| `ğŸŸ¢` | Minor/Nitpick |

---

## Architecture

### Single Source of Truth

```
content/instructions/plan.md     â†’ output/opencode/agents/plan.md (primary agent)
                                 â†’ output/opencode/skills/planning/SKILL.md (skill)

content/instructions/auditor.md  â†’ output/opencode/agents/auditor.md (sub-agent)
```

### Content Types

| Type | Count | Description |
|------|-------|-------------|
| Primary Agents | 4 | Modes user can switch to (audit, frontend-design, quick-edits, workshop) |
| Sub-agents | 11 | Specialized auditors (auditor-*) |
| Skills | 13 | Invokable capabilities |

### Audit Flow

```
PLAN â†’ EXECUTE (+ Audit) â†’ Done
```

- Auditor sub-agent runs **once after execute phase**
- Main agent **cannot self-approve**â€”audit approval required

---

## Adding New Content

### New Skill

1. Create `content/instructions/<skill-name>.md` (body only)
2. Add entry to `config/skills.ts`
3. Run `bun generate.ts`

### New Agent

1. Create `content/instructions/<agent-name>.md` (body only)
2. Add entry to `config/agents.ts` with type (primary/sub)
3. Run `bun generate.ts`

---

## Critical Rules

- **NO SHORTCUTS** â€” Stop and notify if only unsafe workarounds work
- **STAY IN SCOPE** â€” Halt if blocker is outside task scope
- **PROTECT DATA** â€” Never modify development DB destructively
- **NO SELF-APPROVAL** â€” Use auditor sub-agent for code approval
- **NO DEAD CODE** â€” No commented blocks, debug prints, leftover TODOs
- **PREFER EXTENDING** â€” Extend existing files over creating new ones
- **AFTER-TASK CHECKLIST** â€” Run type-check/lint/format/tests
- **UPDATE DOCS** â€” When changing CLI args, configs, or user-facing behavior, always update `README.md` and `shell/zsh-custom.zsh` if affected
- **NEVER EDIT OR SELECT A MODEL**, this is always up to the user
---

## File Types Summary

| Extension | Purpose | Location |
|-----------|---------|----------|
| `.md` | Content, generated output | `content/`, `output/` |
| `.ts` | Generator, installer, config | `*.ts`, `config/` |
| `.json` | Local config (not installed) | `opencode.json` |
