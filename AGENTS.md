# AGENTS.md

This file provides guidance to AI coding agents working in this repository.

## Project Overview

This repository contains opinionated AI guidelines, skills, and agents for **Claude Code**, **OpenCode**, **Codex**, and **Cursor**. The content is installed to user machines via `src/init.ts`. This is a **documentation/configuration repository** with a generator script.

## Repository Structure

```
├── content/                 # SOURCE OF TRUTH (all content)
│   ├── base-rules.md        # Global rules for all modes
│   └── skills/              # All skills (copied wholesale)
│       └── <name>/          # Each skill is a folder
│           ├── SKILL.md     # Main skill file (with frontmatter)
│           └── references/  # Optional bundled resources
├── config/                  # Configuration (DRY)
│   ├── models.ts            # Model definitions (OpenCode + Claude Code)
│   └── mcp.ts               # MCP server definitions (OpenCode + Codex + Cursor)
├── src/                     # Scripts and shared utilities
│   ├── fs.ts                # Shared filesystem utilities
│   ├── print.ts             # Colored console output
│   ├── generate.ts          # Generator script (all tools)
│   └── init.ts              # Installer script (all tools)
├── plugins/                 # OpenCode plugins (source)
│   └── loop.ts              # Autonomous loop plugin
├── cursor/                  # Cursor IDE configuration (source)
│   ├── settings.json        # Cursor settings
│   ├── keybindings.json    # Cursor keybindings
│   └── extensions.txt      # Extensions to install (one ID per line)
├── shell/                   # Shell configuration files
│   ├── zsh-custom.zsh       # Custom zsh config
│   └── zshrc.zsh            # Reference .zshrc (manual setup)
├── output/                  # GENERATED OUTPUT (do not edit directly)
│   ├── opencode/            # OpenCode output
│   │   ├── skills/          # All skills (copied)
│   │   ├── plugin/
│   │   └── opencode-config.json
│   ├── claude/              # Claude Code output
│       ├── skills/          # All skills (copied)
│       └── settings.json
│   ├── codex/               # Codex output
│   │   └── mcp-servers.toml
│   └── cursor/              # Cursor output
│       └── mcp.json
└── AGENTS.md                # AI agent instructions for this repo
```

## Commands

Use `make` for common tasks:

| Command | Description |
|---------|-------------|
| `make install` | Generate + init — **always use this** |
| `make generate` | Generate only (rarely needed) |
| `make init` | Install only (rarely needed) |

**Always run `make install`** after modifying content or config.

---

## Code Style Guidelines

### Skills (`content/skills/`)

Each skill is a folder containing SKILL.md with YAML frontmatter plus optional bundled resources:

```
content/skills/<name>/
├── SKILL.md              # Required: frontmatter (name, description) + body
├── references/           # Optional: documentation loaded on demand
├── scripts/              # Optional: executable code
└── assets/               # Optional: templates, images, etc.
```

**SKILL.md format:**
```yaml
---
name: skill-name
description: When and why to use this skill. Be specific about triggers.
---

# Skill Title

Instructions...
```

### Config Files (`config/`)

- `models.ts` — Model definitions for both tools
- `mcp.ts` — MCP server definitions for OpenCode + Codex

### Generated Files (`output/`)

**DO NOT EDIT DIRECTLY!** These are generated by `src/generate.ts`.

Output is generated for **all tools**:
- `output/opencode/` — OpenCode format
- `output/claude/` — Claude Code format
- `output/codex/` — Codex MCP config snippet

Skills are copied wholesale (folder structure preserved).

To modify output:
1. Edit content in `content/skills/<name>/`
2. Run `make install`

### Markdown Content Structure

- Use heading hierarchy (`#`, `##`, `###`)
- Tables for structured data
- Code blocks with language hints
- Line references: `[file:line]` or `[path:line-line]`

**Status Markers**:
| Marker | Meaning |
|--------|---------|
| `[ ]` | Pending |
| `[x]` | Done |
| `[~]` | Blocked |
| `[!]` | Needs decision |

---

## Architecture

### Skills-First Approach

Everything is a skill. Skills are loaded on-demand via the `skill` tool. Each skill folder is copied wholesale to output, preserving bundled resources.

```
content/skills/<name>/  →  output/opencode/skills/<name>/
                        →  output/claude/skills/<name>/
```

### Audit Flow

```
EXECUTE → Audit Orchestrator (skill) → Auditor Sub-Agents (load auditor skills) → Done
```

- `audit-orchestrator` skill spawns sub-agents that load specialized auditor skills
- Auditors review and report; orchestrator fixes issues
- Main agent **cannot self-approve**—audit approval required

---

## Adding New Content

### New Skill

1. Create folder: `content/skills/<skill-name>/`
2. Create `SKILL.md` with frontmatter:
   ```yaml
   ---
   name: skill-name
   description: When to use this skill. Be specific.
   ---
   
   # Skill Title
   
   Instructions...
   ```
3. Optionally add `references/`, `scripts/`, `assets/` folders
4. Run `make install`

### External Skills

To add an external skill (e.g., from GitHub):
1. Copy the skill folder to `content/skills/<name>/`
2. Ensure it has `SKILL.md` with proper frontmatter
3. Run `make install`

---

## Critical Rules

- **UPDATE DOCS** — When changing CLI args, configs, or user-facing behavior, always update `README.md` and `shell/zsh-custom.zsh` if affected
- **NEVER EDIT OR SELECT A MODEL**, this is always up to the user
- **READ CLAUDE DOCS** — When working with Claude Code features (plugins, commands, skills, agents, config), always fetch and read https://docs.anthropic.com/en/docs/claude-code first to ensure correct format and API usage
- **READ OPENCODE DOCS** — When working with OpenCode features (agents, config, models, temperature), refer to `opencode-docs-ref.md` or fetch https://opencode.ai/docs for current documentation

---

## File Types Summary

| Extension | Purpose | Location |
|-----------|---------|----------|
| `.md` | Skills, content, generated output | `content/skills/`, `output/` |
| `.ts` | Scripts, utilities, config | `src/`, `config/` |
| `.json` | Local config (not installed) | `opencode.json` |
